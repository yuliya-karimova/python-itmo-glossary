<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–ª–æ—Å—Å–∞—Ä–∏–π Backend-Driven UI - –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –≥—Ä–∞—Ñ</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .controls {
            padding: 20px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .controls button {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .controls button:hover {
            background: #5568d3;
        }
        
        .controls input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            flex: 1;
            min-width: 200px;
        }
        
        .main-content {
            display: flex;
            height: calc(100vh - 250px);
            min-height: 600px;
        }
        
        #graph-container {
            flex: 1;
            border-right: 1px solid #e0e0e0;
            position: relative;
        }
        
        .sidebar {
            width: 350px;
            background: #f8f9fa;
            padding: 20px;
            overflow-y: auto;
            max-height: 100%;
        }
        
        .term-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .term-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }
        
        .term-card.selected {
            border: 2px solid #667eea;
            background: #f0f4ff;
        }
        
        .term-keyword {
            font-size: 1.2em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 8px;
        }
        
        .term-description {
            color: #666;
            font-size: 0.9em;
            line-height: 1.5;
            margin-bottom: 8px;
        }
        
        .term-source {
            font-size: 0.8em;
            color: #999;
            font-style: italic;
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 18px;
            color: #667eea;
        }
        
        .error {
            background: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 5px;
            margin: 20px;
        }
        
        .stats {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .stats h3 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .stats p {
            color: #666;
            font-size: 0.9em;
        }
        
        .view-btn {
            padding: 10px 20px;
            background: #e0e0e0;
            color: #333;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
            margin-right: 10px;
        }
        
        .view-btn.active {
            background: #667eea;
            color: white;
        }
        
        .view-btn:hover {
            background: #5568d3;
            color: white;
        }
        
        .view-container {
            display: flex;
            height: calc(100vh - 250px);
            min-height: 600px;
        }
        
        .list-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f8f9fa;
        }
        
        .term-card-full {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .term-card-full:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .term-card-full .term-keyword {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 12px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
        }
        
        .term-card-full .term-description {
            color: #333;
            font-size: 1em;
            line-height: 1.6;
            white-space: pre-line;
        }
        
        .legend {
            position: absolute;
            top: 120px;
            right: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            max-width: 250px;
            max-height: 400px;
            overflow-y: auto;
            z-index: 1000;
        }
        
        .legend h3 {
            margin: 0 0 10px 0;
            color: #667eea;
            font-size: 1em;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 0.85em;
        }
        
        .legend-color {
            width: 20px;
            height: 3px;
            margin-right: 8px;
            display: inline-block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö –ì–ª–æ—Å—Å–∞—Ä–∏–π Backend-Driven UI</h1>
            <p>–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –≥—Ä–∞—Ñ —Ç–µ—Ä–º–∏–Ω–æ–≤ –∏ –∏—Ö –≤–∑–∞–∏–º–æ—Å–≤—è–∑–µ–π</p>
        </div>
        
        <div class="controls">
            <button onclick="switchView('graph')" id="btn-graph" class="view-btn active">üìä –ì—Ä–∞—Ñ</button>
            <button onclick="switchView('list')" id="btn-list" class="view-btn">üìã –°–ø–∏—Å–æ–∫</button>
            <button onclick="loadGraph()" id="btn-refresh" style="display: none;">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
            <button onclick="resetView()" id="btn-reset" style="display: none;">üéØ –°–±—Ä–æ—Å–∏—Ç—å –≤–∏–¥</button>
            <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ —Ç–µ—Ä–º–∏–Ω–∞..." onkeyup="searchTerm(event)" style="display: none;">
            <button onclick="clearSearch()" id="btn-clear" style="display: none;">‚úñÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
            <button onclick="toggleLegend()" id="btn-legend" style="display: none;">üìã –õ–µ–≥–µ–Ω–¥–∞</button>
        </div>
        
        <div id="legend" class="legend" style="display: none;">
            <h3>–¢–∏–ø—ã —Å–≤—è–∑–µ–π:</h3>
            <div id="legend-content"></div>
        </div>
        
        <div class="main-content">
            <!-- –í–∏–¥ –≥—Ä–∞—Ñ–∞ -->
            <div id="graph-view" class="view-container">
                <div id="graph-container">
                    <div class="loading" id="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –≥—Ä–∞—Ñ–∞...</div>
                </div>
                
                <div class="sidebar">
                    <div class="stats">
                        <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                        <p id="statsText">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                    </div>
                    <div id="terms-list"></div>
                </div>
            </div>
            
            <!-- –í–∏–¥ —Å–ø–∏—Å–∫–∞ -->
            <div id="list-view" class="view-container" style="display: none;">
                <div class="list-container">
                    <div id="terms-cards"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let network = null;
        let nodes = null;
        let edges = null;
        let allNodes = [];
        let allEdges = [];
        let selectedNodeId = null;
        
        const API_BASE = window.location.origin;
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ü–≤–µ—Ç–∞ —Å–≤—è–∑–∏ –ø–æ —Ç–∏–ø—É (–≥–ª–æ–±–∞–ª—å–Ω–∞—è)
        function getRelationColor(relationType) {
            const colorMap = {
                '—è–≤–ª—è–µ—Ç—Å—è–ß–∞—Å—Ç—å—é': '#e74c3c',
                '–≤–∫–ª—é—á–∞–µ—Ç–í': '#3498db',
                '—è–≤–ª—è–µ—Ç—Å—è–í–∏–¥–æ–º': '#9b59b6',
                '—è–≤–ª—è–µ—Ç—Å—è–ü–æ–¥—Ç–∏–ø–æ–º': '#e67e22',
                '—Å–≤—è–∑–∞–Ω–∞–°': '#1abc9c',
                '–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è–î–ª—è': '#f39c12',
                '–æ—Ü–µ–Ω–∏–≤–∞–µ—Ç—Å—è–ü–æ': '#16a085',
                '–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è–í': '#34495e',
                '–æ–ø–∏—Å—ã–≤–∞–µ—Ç': '#27ae60',
                '—Å–æ–¥–µ—Ä–∂–∏—Ç': '#8e44ad',
                '–ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è–í–§–æ—Ä–º–∞—Ç–µ': '#c0392b',
                '–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç': '#2980b9',
                '–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è–ü–æ': '#d35400',
                '–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è–ß–µ—Ä–µ–∑': '#d35400',
                '–æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç—Å—è': '#7f8c8d',
                '—Ç—Ä–µ–±—É–µ—Ç': '#95a5a6',
                '—Ç—Ä–µ–±—É–µ—Ç–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è': '#bdc3c7',
                '–≤–ª–∏—è–µ—Ç–ù–∞': '#ecf0f1',
                '–∏–∑–º–µ—Ä—è–µ—Ç—Å—è–ú–µ—Ç—Ä–∏–∫–æ–π': '#2ecc71',
                '–º–æ–∂–µ—Ç–£–≤–µ–ª–∏—á–∏–≤–∞—Ç—å': '#e91e63',
                '–æ–±—ã—á–Ω–æ–°–Ω–∏–∂–∞–µ—Ç': '#00bcd4',
                '—Å–Ω–∏–∂–∞–µ—Ç': '#4caf50',
                '—É—Å–∫–æ—Ä—è–µ—Ç': '#ff9800',
                '—É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç': '#f44336',
                '–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç': '#2196f3',
                '–ø–æ–≤—ã—à–∞–µ—Ç': '#9c27b0',
                'related': '#999'
            };
            return colorMap[relationType] || '#999';
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–∞
        async function loadGraph() {
            const loadingEl = document.getElementById('loading');
            loadingEl.style.display = 'block';
            
            try {
                const response = await fetch(`${API_BASE}/terms/graph/data`);
                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
                
                const data = await response.json();
                allNodes = data.nodes;
                allEdges = data.edges;
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                document.getElementById('statsText').innerHTML = `
                    <strong>–¢–µ—Ä–º–∏–Ω–æ–≤:</strong> ${allNodes.length}<br>
                    <strong>–°–≤—è–∑–µ–π:</strong> ${allEdges.length}
                `;
                
                // –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
                createVisualization(allNodes, allEdges);
                
                // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Ç–µ—Ä–º–∏–Ω–æ–≤ –≤ —Å–∞–π–¥–±–∞—Ä–µ
                loadTermsListSidebar();
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–µ–≥–µ–Ω–¥—ã
                updateLegend();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                document.getElementById('graph-container').innerHTML = 
                    `<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ${error.message}</div>`;
            } finally {
                loadingEl.style.display = 'none';
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –≥—Ä–∞—Ñ–∞
        function createVisualization(nodesData, edgesData) {
            const container = document.getElementById('graph-container');
            
            // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è vis-network
            nodes = new vis.DataSet(nodesData.map(node => {
                // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è tooltip
                const description = node.description || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç';
                // –£–±–∏—Ä–∞–µ–º –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ –¥–ª—è HTML tooltip
                const cleanDesc = description.replace(/\n/g, ' ').trim();
                const shortDesc = cleanDesc.length > 300 ? cleanDesc.substring(0, 300) + '...' : cleanDesc;
                
                return {
                    id: node.id,
                    label: node.label,
                    title: `${node.label}\n\n${shortDesc}`,
                    color: {
                        background: '#667eea',
                        border: '#5568d3',
                        highlight: {
                            background: '#764ba2',
                            border: '#667eea'
                        }
                    },
                    font: {
                        size: 16,
                        color: '#333'
                    },
                    shape: 'box',
                    margin: 10
                };
            }));
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è –¥–ª–∏–Ω–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–≤—è–∑–µ–π
            function shortenRelationType(relationType) {
                if (relationType.length > 15) {
                    return relationType.substring(0, 12) + '...';
                }
                return relationType;
            }
            
            edges = new vis.DataSet(edgesData.map(edge => ({
                from: edge.from,
                to: edge.to,
                label: shortenRelationType(edge.type || 'related'),
                arrows: 'to',
                color: {
                    color: getRelationColor(edge.type || 'related'),
                    highlight: '#667eea'
                },
                width: 2,
                font: {
                    size: 10,
                    align: 'middle',
                    color: '#333'
                },
                smooth: {
                    type: 'continuous',
                    roundness: 0.5
                }
            })));
            
            const data = { nodes, edges };
            
            const options = {
                nodes: {
                    shape: 'box',
                    font: {
                        size: 14,
                        face: 'Segoe UI'
                    },
                    borderWidth: 2,
                    shadow: true
                },
                edges: {
                    arrows: {
                        to: {
                            enabled: true,
                            scaleFactor: 0.8
                        }
                    },
                    smooth: {
                        type: 'continuous',
                        roundness: 0.3
                    },
                    shadow: true,
                    font: {
                        size: 10,
                        align: 'middle'
                    },
                    labelHighlightBold: false
                },
                physics: {
                    enabled: true,
                    stabilization: {
                        enabled: true,
                        iterations: 300
                    },
                    barnesHut: {
                        gravitationalConstant: -3000,
                        centralGravity: 0.05,
                        springLength: 150,
                        springConstant: 0.05,
                        damping: 0.1
                    }
                },
                interaction: {
                    hover: true,
                    tooltipDelay: 200,
                    zoomView: true,
                    dragView: true
                },
                layout: {
                    improvedLayout: true
                }
            };
            
            network = new vis.Network(container, data, options);
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π
            network.on('click', function(params) {
                if (params.nodes.length > 0) {
                    const nodeId = params.nodes[0];
                    highlightNode(nodeId);
                    showTermDetails(nodeId);
                } else {
                    clearSelection();
                }
            });
            
            network.on('hoverNode', function(params) {
                container.style.cursor = 'pointer';
            });
            
            network.on('blurNode', function(params) {
                container.style.cursor = 'default';
            });
        }
        
        // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —É–∑–ª–∞
        function highlightNode(nodeId) {
            selectedNodeId = nodeId;
            const node = allNodes.find(n => n.id === nodeId);
            if (!node) return;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–µ—Ä–º–∏–Ω–æ–≤
            const cards = document.querySelectorAll('.term-card');
            cards.forEach(card => {
                if (parseInt(card.dataset.id) === nodeId) {
                    card.classList.add('selected');
                    card.scrollIntoView({ behavior: 'smooth', block: 'center' });
                } else {
                    card.classList.remove('selected');
                }
            });
            
            // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –≤ –≥—Ä–∞—Ñ–µ
            const connectedNodes = network.getConnectedNodes(nodeId);
            const highlightNodes = [nodeId, ...connectedNodes];
            
            nodes.update(nodes.get().map(n => ({
                ...n,
                color: highlightNodes.includes(n.id) ? {
                    background: n.id === nodeId ? '#764ba2' : '#a8b5ff',
                    border: n.id === nodeId ? '#667eea' : '#667eea',
                    highlight: {
                        background: '#764ba2',
                        border: '#667eea'
                    }
                } : {
                    background: '#e0e0e0',
                    border: '#ccc',
                    highlight: {
                        background: '#667eea',
                        border: '#5568d3'
                    }
                }
            })));
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ —Ç–µ—Ä–º–∏–Ω–∞
        function showTermDetails(nodeId) {
            const node = allNodes.find(n => n.id === nodeId);
            if (!node) return;
            
            // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –¥–µ—Ç–∞–ª—è–º–∏
            console.log('–í—ã–±—Ä–∞–Ω —Ç–µ—Ä–º–∏–Ω:', node);
        }
        
        // –û—á–∏—Å—Ç–∏—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ
        function clearSelection() {
            selectedNodeId = null;
            document.querySelectorAll('.term-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            nodes.update(nodes.get().map(n => ({
                ...n,
                color: {
                    background: '#667eea',
                    border: '#5568d3',
                    highlight: {
                        background: '#764ba2',
                        border: '#667eea'
                    }
                }
            })));
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Ç–µ—Ä–º–∏–Ω–æ–≤ –≤ —Å–∞–π–¥–±–∞—Ä–µ (–¥–ª—è –≥—Ä–∞—Ñ–∞)
        async function loadTermsListSidebar() {
            try {
                const response = await fetch(`${API_BASE}/terms`);
                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ—Ä–º–∏–Ω–æ–≤');
                
                const terms = await response.json();
                const listContainer = document.getElementById('terms-list');
                
                listContainer.innerHTML = terms.map(term => `
                    <div class="term-card" data-id="${term.id}" onclick="selectTerm(${term.id})">
                        <div class="term-keyword">${term.keyword}</div>
                        <div class="term-description">${term.description.substring(0, 100)}${term.description.length > 100 ? '...' : ''}</div>
                        ${term.source ? `<div class="term-source">–ò—Å—Ç–æ—á–Ω–∏–∫: ${term.source}</div>` : ''}
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ —Ç–µ—Ä–º–∏–Ω–æ–≤:', error);
            }
        }
        
        // –í—ã–±–æ—Ä —Ç–µ—Ä–º–∏–Ω–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
        function selectTerm(termId) {
            if (network) {
                network.focus(termId, {
                    scale: 1.5,
                    animation: {
                        duration: 1000,
                        easingFunction: 'easeInOutQuad'
                    }
                });
                highlightNode(termId);
            }
        }
        
        // –ü–æ–∏—Å–∫ —Ç–µ—Ä–º–∏–Ω–∞
        function searchTerm(event) {
            if (event.key === 'Enter') {
                const searchValue = document.getElementById('searchInput').value.toLowerCase().trim();
                if (!searchValue) {
                    clearSearch();
                    return;
                }
                
                const foundNode = allNodes.find(node => 
                    node.label.toLowerCase().includes(searchValue) ||
                    node.description.toLowerCase().includes(searchValue)
                );
                
                if (foundNode && network) {
                    selectTerm(foundNode.id);
                } else {
                    alert('–¢–µ—Ä–º–∏–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω');
                }
            }
        }
        
        // –û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫
        function clearSearch() {
            document.getElementById('searchInput').value = '';
            clearSelection();
            if (network) {
                network.fit({
                    animation: {
                        duration: 1000,
                        easingFunction: 'easeInOutQuad'
                    }
                });
            }
        }
        
        // –°–±—Ä–æ—Å–∏—Ç—å –≤–∏–¥
        function resetView() {
            clearSearch();
            if (network) {
                network.fit({
                    animation: {
                        duration: 1000,
                        easingFunction: 'easeInOutQuad'
                    }
                });
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –ª–µ–≥–µ–Ω–¥—É
        function toggleLegend() {
            const legend = document.getElementById('legend');
            legend.style.display = legend.style.display === 'none' ? 'block' : 'none';
            if (legend.style.display === 'block') {
                updateLegend();
            }
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å –ª–µ–≥–µ–Ω–¥—É
        function updateLegend() {
            const legendContent = document.getElementById('legend-content');
            const relationTypes = new Set();
            
            allEdges.forEach(edge => {
                if (edge.type) {
                    relationTypes.add(edge.type);
                }
            });
            
            const sortedTypes = Array.from(relationTypes).sort();
            legendContent.innerHTML = sortedTypes.map(type => {
                const color = getRelationColor(type);
                return `
                    <div class="legend-item">
                        <span class="legend-color" style="background-color: ${color};"></span>
                        <span>${type}</span>
                    </div>
                `;
            }).join('');
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –≤–∏–¥–∞–º–∏
        function switchView(viewType) {
            const graphView = document.getElementById('graph-view');
            const listView = document.getElementById('list-view');
            const btnGraph = document.getElementById('btn-graph');
            const btnList = document.getElementById('btn-list');
            const graphControls = ['btn-refresh', 'btn-reset', 'searchInput', 'btn-clear', 'btn-legend'];
            
            if (!graphView || !listView || !btnGraph || !btnList) {
                console.error('–ù–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã DOM');
                return;
            }
            
            if (viewType === 'graph') {
                graphView.style.display = 'flex';
                listView.style.display = 'none';
                btnGraph.classList.add('active');
                btnList.classList.remove('active');
                graphControls.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.style.display = 'inline-block';
                });
                if (!network) {
                    loadGraph();
                }
            } else {
                graphView.style.display = 'none';
                listView.style.display = 'block';
                btnGraph.classList.remove('active');
                btnList.classList.add('active');
                graphControls.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.style.display = 'none';
                });
                loadTermsList();
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Ç–µ—Ä–º–∏–Ω–æ–≤ –≤ –≤–∏–¥–µ –∫–∞—Ä—Ç–æ—á–µ–∫ (–¥–ª—è –≤–∏–¥–∞ —Å–ø–∏—Å–∫–∞)
        async function loadTermsList() {
            try {
                const response = await fetch(`${API_BASE}/terms?limit=1000`);
                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ—Ä–º–∏–Ω–æ–≤');
                
                const terms = await response.json();
                const container = document.getElementById('terms-cards');
                
                // –°–æ—Ä—Ç–∏—Ä—É–µ–º —Ç–µ—Ä–º–∏–Ω—ã –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É
                terms.sort((a, b) => a.keyword.localeCompare(b.keyword));
                
                container.innerHTML = terms.map(term => `
                    <div class="term-card-full">
                        <div class="term-keyword">${term.keyword}</div>
                        <div class="term-description">${term.description || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}</div>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ —Ç–µ—Ä–º–∏–Ω–æ–≤:', error);
                document.getElementById('terms-cards').innerHTML = 
                    `<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ${error.message}</div>`;
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', () => {
            // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ—Ç–∫—Ä—ã–≤–∞–µ–º –≥—Ä–∞—Ñ
            switchView('graph');
        });
    </script>
</body>
</html>

