<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–ª–æ—Å—Å–∞—Ä–∏–π Backend-Driven UI - –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –≥—Ä–∞—Ñ</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .controls {
            padding: 20px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .controls button {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .controls button:hover {
            background: #5568d3;
        }
        
        .controls input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            flex: 1;
            min-width: 200px;
        }
        
        .main-content {
            display: flex;
            height: calc(100vh - 250px);
            min-height: 600px;
        }
        
        #graph-container {
            flex: 1;
            border-right: 1px solid #e0e0e0;
            position: relative;
        }
        
        .sidebar {
            width: 350px;
            background: #f8f9fa;
            padding: 20px;
            overflow-y: auto;
            max-height: 100%;
        }
        
        .term-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .term-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }
        
        .term-card.selected {
            border: 2px solid #667eea;
            background: #f0f4ff;
        }
        
        .term-keyword {
            font-size: 1.2em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 8px;
        }
        
        .term-description {
            color: #666;
            font-size: 0.9em;
            line-height: 1.5;
            margin-bottom: 8px;
        }
        
        .term-source {
            font-size: 0.8em;
            color: #999;
            font-style: italic;
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 18px;
            color: #667eea;
        }
        
        .error {
            background: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 5px;
            margin: 20px;
        }
        
        .stats {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .stats h3 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .stats p {
            color: #666;
            font-size: 0.9em;
        }
        
        .view-btn {
            padding: 10px 20px;
            background: #e0e0e0;
            color: #333;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
            margin-right: 10px;
        }
        
        .view-btn.active {
            background: #667eea;
            color: white;
        }
        
        .view-btn:hover {
            background: #5568d3;
            color: white;
        }
        
        .view-container {
            display: flex;
            height: calc(100vh - 250px);
            min-height: 600px;
        }
        
        .list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            flex-shrink: 0;
        }
        
        .list-header h2 {
            color: #667eea;
            margin: 0;
        }
        
        .list-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            overflow-x: hidden;
            background: #f8f9fa;
            min-height: 0;
        }
        
        .term-card-full {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .term-card-full:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .term-card-full .term-keyword {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 12px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
        }
        
        .term-card-full .term-description {
            color: #333;
            font-size: 1em;
            line-height: 1.6;
            white-space: pre-line;
        }
        
        .legend {
            position: absolute;
            top: 120px;
            right: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            max-width: 250px;
            max-height: 400px;
            overflow-y: auto;
            z-index: 1000;
        }
        
        .legend h3 {
            margin: 0 0 10px 0;
            color: #667eea;
            font-size: 1em;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 0.85em;
        }
        
        .legend-color {
            width: 20px;
            height: 3px;
            margin-right: 8px;
            display: inline-block;
        }
        
        .zoom-controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            z-index: 10000;
            pointer-events: none;
        }
        
        .zoom-controls .zoom-btn {
            pointer-events: auto;
        }
        
        .zoom-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
        }
        
        .zoom-btn:hover {
            background: #667eea;
            color: white;
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .zoom-btn:active {
            transform: scale(0.95);
        }
        
        #graph-container {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        
        .management-section {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .management-section h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1em;
        }
        
        .manage-btn {
            width: 100%;
            padding: 10px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .manage-btn:hover {
            background: #5568d3;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            overflow: auto;
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 15px;
        }
        
        .modal-header h2 {
            color: #667eea;
            margin: 0;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 28px;
            font-weight: bold;
            color: #999;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            line-height: 30px;
        }
        
        .close-modal:hover {
            color: #333;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }
        
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            font-family: inherit;
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 25px;
        }
        
        .btn-primary {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .btn-primary:hover {
            background: #5568d3;
        }
        
        .btn-danger {
            padding: 10px 20px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-secondary {
            padding: 10px 20px;
            background: #95a5a6;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .btn-secondary:hover {
            background: #7f8c8d;
        }
        
        .term-actions {
            display: flex;
            gap: 5px;
            margin-top: 8px;
        }
        
        .term-actions button {
            padding: 5px 10px;
            font-size: 12px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            transition: opacity 0.3s;
        }
        
        .term-actions .btn-edit {
            background: #3498db;
            color: white;
        }
        
        .term-actions .btn-edit:hover {
            background: #2980b9;
        }
        
        .term-actions .btn-delete {
            background: #e74c3c;
            color: white;
        }
        
        .term-actions .btn-delete:hover {
            background: #c0392b;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö –ì–ª–æ—Å—Å–∞—Ä–∏–π Backend-Driven UI</h1>
            <p>–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –≥—Ä–∞—Ñ —Ç–µ—Ä–º–∏–Ω–æ–≤ –∏ –∏—Ö –≤–∑–∞–∏–º–æ—Å–≤—è–∑–µ–π</p>
        </div>
        
        <div class="controls">
            <button onclick="switchView('graph')" id="btn-graph" class="view-btn active">üìä –ì—Ä–∞—Ñ</button>
            <button onclick="switchView('list')" id="btn-list" class="view-btn">üìã –°–ø–∏—Å–æ–∫</button>
            <button onclick="loadGraph()" id="btn-refresh" style="display: none;">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
            <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ —Ç–µ—Ä–º–∏–Ω–∞..." onkeyup="searchTerm(event)" style="display: none;">
            <button onclick="clearSearch()" id="btn-clear" style="display: none;">‚úñÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
            <button onclick="toggleLegend()" id="btn-legend" style="display: none;">üìã –õ–µ–≥–µ–Ω–¥–∞</button>
        </div>
        
        <div id="legend" class="legend" style="display: none;">
            <h3>–¢–∏–ø—ã —Å–≤—è–∑–µ–π:</h3>
            <div id="legend-content"></div>
        </div>
        
        <div class="main-content">
            <!-- –í–∏–¥ –≥—Ä–∞—Ñ–∞ -->
            <div id="graph-view" class="view-container">
                <div id="graph-container">
                    <div class="loading" id="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –≥—Ä–∞—Ñ–∞...</div>
                    <!-- –ö–Ω–æ–ø–∫–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è -->
                    <div class="zoom-controls">
                        <button onclick="zoomIn()" class="zoom-btn" title="–ü—Ä–∏–±–ª–∏–∑–∏—Ç—å">+</button>
                        <button onclick="zoomOut()" class="zoom-btn" title="–û—Ç–¥–∞–ª–∏—Ç—å">‚àí</button>
                        <button onclick="resetZoom()" class="zoom-btn" title="–°–±—Ä–æ—Å–∏—Ç—å –º–∞—Å—à—Ç–∞–±">‚åÇ</button>
                    </div>
                </div>
                
                <div class="sidebar">
                    <div class="stats">
                        <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                        <p id="statsText">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                    </div>
                    <div class="management-section">
                        <h3>‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h3>
                        <button onclick="showAddTermModal()" class="manage-btn">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Ä–º–∏–Ω</button>
                    </div>
                    <div id="terms-list"></div>
                </div>
            </div>
            
            <!-- –í–∏–¥ —Å–ø–∏—Å–∫–∞ -->
            <div id="list-view" class="view-container" style="display: none; flex-direction: column;">
                <div class="list-header">
                    <h2>–°–ø–∏—Å–æ–∫ —Ç–µ—Ä–º–∏–Ω–æ–≤</h2>
                    <button onclick="showAddTermModal()" class="manage-btn">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Ä–º–∏–Ω</button>
                </div>
                <div class="list-container">
                    <div id="terms-cards"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ—Ä–º–∏–Ω–∞ -->
    <div id="termModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Ä–º–∏–Ω</h2>
                <button class="close-modal" onclick="closeTermModal()">&times;</button>
            </div>
            <form id="termForm" onsubmit="handleTermSubmit(event)">
                <input type="hidden" id="termId" value="">
                <div class="form-group">
                    <label for="termKeyword">–ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ *</label>
                    <input type="text" id="termKeyword" required minlength="1" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ">
                </div>
                <div class="form-group">
                    <label for="termDescription">–û–ø–∏—Å–∞–Ω–∏–µ *</label>
                    <textarea id="termDescription" required minlength="1" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–∞"></textarea>
                </div>
                <div class="form-group">
                    <label for="termSource">–ò—Å—Ç–æ—á–Ω–∏–∫</label>
                    <input type="text" id="termSource" placeholder="–ò—Å—Ç–æ—á–Ω–∏–∫ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeTermModal()">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn-primary" id="submitBtn">–î–æ–±–∞–≤–∏—Ç—å</button>
                    <button type="button" class="btn-danger" id="deleteBtn" style="display: none;" onclick="deleteTermFromModal()">–£–¥–∞–ª–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let network = null;
        let nodes = null;
        let edges = null;
        let allNodes = [];
        let allEdges = [];
        let selectedNodeId = null;
        
        const API_BASE = window.location.origin;
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ü–≤–µ—Ç–∞ —Å–≤—è–∑–∏ –ø–æ —Ç–∏–ø—É (–≥–ª–æ–±–∞–ª—å–Ω–∞—è)
        function getRelationColor(relationType) {
            const colorMap = {
                '—è–≤–ª—è–µ—Ç—Å—è–ß–∞—Å—Ç—å—é': '#e74c3c',
                '–≤–∫–ª—é—á–∞–µ—Ç–í': '#3498db',
                '—è–≤–ª—è–µ—Ç—Å—è–í–∏–¥–æ–º': '#9b59b6',
                '—è–≤–ª—è–µ—Ç—Å—è–ü–æ–¥—Ç–∏–ø–æ–º': '#e67e22',
                '—Å–≤—è–∑–∞–Ω–∞–°': '#1abc9c',
                '–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è–î–ª—è': '#f39c12',
                '–æ—Ü–µ–Ω–∏–≤–∞–µ—Ç—Å—è–ü–æ': '#16a085',
                '–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è–í': '#34495e',
                '–æ–ø–∏—Å—ã–≤–∞–µ—Ç': '#27ae60',
                '—Å–æ–¥–µ—Ä–∂–∏—Ç': '#8e44ad',
                '–ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è–í–§–æ—Ä–º–∞—Ç–µ': '#c0392b',
                '–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç': '#2980b9',
                '–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è–ü–æ': '#d35400',
                '–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è–ß–µ—Ä–µ–∑': '#d35400',
                '–æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç—Å—è': '#7f8c8d',
                '—Ç—Ä–µ–±—É–µ—Ç': '#95a5a6',
                '—Ç—Ä–µ–±—É–µ—Ç–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è': '#bdc3c7',
                '–≤–ª–∏—è–µ—Ç–ù–∞': '#ecf0f1',
                '–∏–∑–º–µ—Ä—è–µ—Ç—Å—è–ú–µ—Ç—Ä–∏–∫–æ–π': '#2ecc71',
                '–º–æ–∂–µ—Ç–£–≤–µ–ª–∏—á–∏–≤–∞—Ç—å': '#e91e63',
                '–æ–±—ã—á–Ω–æ–°–Ω–∏–∂–∞–µ—Ç': '#00bcd4',
                '—Å–Ω–∏–∂–∞–µ—Ç': '#4caf50',
                '—É—Å–∫–æ—Ä—è–µ—Ç': '#ff9800',
                '—É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç': '#f44336',
                '–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç': '#2196f3',
                '–ø–æ–≤—ã—à–∞–µ—Ç': '#9c27b0',
                'related': '#999'
            };
            return colorMap[relationType] || '#999';
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–∞
        async function loadGraph() {
            const loadingEl = document.getElementById('loading');
            const container = document.getElementById('graph-container');
            
            if (!container) {
                console.error('–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –≥—Ä–∞—Ñ–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω');
                return;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏, –µ—Å–ª–∏ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
            if (loadingEl) {
                loadingEl.style.display = 'block';
            }
            
            try {
                const response = await fetch(`${API_BASE}/terms/graph/data`);
                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
                
                const data = await response.json();
                allNodes = data.nodes;
                allEdges = data.edges;
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                const statsText = document.getElementById('statsText');
                if (statsText) {
                    statsText.innerHTML = `
                        <strong>–¢–µ—Ä–º–∏–Ω–æ–≤:</strong> ${allNodes.length}<br>
                        <strong>–°–≤—è–∑–µ–π:</strong> ${allEdges.length}
                    `;
                }
                
                // –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
                createVisualization(allNodes, allEdges);
                
                // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Ç–µ—Ä–º–∏–Ω–æ–≤ –≤ —Å–∞–π–¥–±–∞—Ä–µ
                loadTermsListSidebar();
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–µ–≥–µ–Ω–¥—ã
                updateLegend();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                container.innerHTML = 
                    `<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ${error.message}</div>`;
            } finally {
                // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏, –µ—Å–ª–∏ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
                if (loadingEl) {
                    loadingEl.style.display = 'none';
                }
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –≥—Ä–∞—Ñ–∞
        function createVisualization(nodesData, edgesData) {
            const container = document.getElementById('graph-container');
            
            if (!container) {
                console.error('–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –≥—Ä–∞—Ñ–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω');
                return;
            }
            
            // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –Ω–æ–≤–æ–≥–æ –≥—Ä–∞—Ñ–∞
            if (network) {
                network.destroy();
                network = null;
            }
            
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã, –µ—Å–ª–∏ –µ—Å—Ç—å
            const loadingEl = document.getElementById('loading');
            if (loadingEl) {
                loadingEl.style.display = 'none';
            }
            
            // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è vis-network
            nodes = new vis.DataSet(nodesData.map(node => {
                // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è tooltip
                const description = node.description || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç';
                // –£–±–∏—Ä–∞–µ–º –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ –¥–ª—è HTML tooltip
                const cleanDesc = description.replace(/\n/g, ' ').trim();
                const shortDesc = cleanDesc.length > 300 ? cleanDesc.substring(0, 300) + '...' : cleanDesc;
                
                return {
                    id: node.id,
                    label: node.label,
                    title: `${node.label}\n\n${shortDesc}`,
                    color: {
                        background: '#667eea',
                        border: '#5568d3',
                        highlight: {
                            background: '#764ba2',
                            border: '#667eea'
                        }
                    },
                    font: {
                        size: 16,
                        color: '#333'
                    },
                    shape: 'box',
                    margin: 10
                };
            }));
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è –¥–ª–∏–Ω–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–≤—è–∑–µ–π
            function shortenRelationType(relationType) {
                if (relationType.length > 15) {
                    return relationType.substring(0, 12) + '...';
                }
                return relationType;
            }
            
            edges = new vis.DataSet(edgesData.map(edge => ({
                from: edge.from,
                to: edge.to,
                label: shortenRelationType(edge.type || 'related'),
                arrows: 'to',
                color: {
                    color: getRelationColor(edge.type || 'related'),
                    highlight: '#667eea'
                },
                width: 2,
                font: {
                    size: 10,
                    align: 'middle',
                    color: '#333'
                },
                smooth: {
                    type: 'continuous',
                    roundness: 0.5
                }
            })));
            
            const data = { nodes, edges };
            
            const options = {
                nodes: {
                    shape: 'box',
                    font: {
                        size: 14,
                        face: 'Segoe UI'
                    },
                    borderWidth: 2,
                    shadow: true
                },
                edges: {
                    arrows: {
                        to: {
                            enabled: true,
                            scaleFactor: 0.8
                        }
                    },
                    smooth: {
                        type: 'continuous',
                        roundness: 0.3
                    },
                    shadow: true,
                    font: {
                        size: 10,
                        align: 'middle'
                    },
                    labelHighlightBold: false
                },
                physics: {
                    enabled: true,
                    stabilization: {
                        enabled: true,
                        iterations: 300
                    },
                    barnesHut: {
                        gravitationalConstant: -3000,
                        centralGravity: 0.05,
                        springLength: 150,
                        springConstant: 0.05,
                        damping: 0.1
                    }
                },
                interaction: {
                    hover: true,
                    tooltipDelay: 200,
                    zoomView: true,
                    dragView: true
                },
                layout: {
                    improvedLayout: true
                }
            };
            
            network = new vis.Network(container, data, options);
            
            // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –∫–Ω–æ–ø–∫–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ DOM
            // vis-network –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å –∏—Ö –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
            let zoomControls = container.querySelector('.zoom-controls');
            if (!zoomControls) {
                zoomControls = document.createElement('div');
                zoomControls.className = 'zoom-controls';
                zoomControls.innerHTML = `
                    <button onclick="zoomIn()" class="zoom-btn" title="–ü—Ä–∏–±–ª–∏–∑–∏—Ç—å">+</button>
                    <button onclick="zoomOut()" class="zoom-btn" title="–û—Ç–¥–∞–ª–∏—Ç—å">‚àí</button>
                    <button onclick="resetZoom()" class="zoom-btn" title="–°–±—Ä–æ—Å–∏—Ç—å –º–∞—Å—à—Ç–∞–±">‚åÇ</button>
                `;
                container.appendChild(zoomControls);
            }
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π
            network.on('click', function(params) {
                if (params.nodes.length > 0) {
                    const nodeId = params.nodes[0];
                    highlightNode(nodeId);
                    showTermDetails(nodeId);
                } else {
                    clearSelection();
                }
            });
            
            network.on('hoverNode', function(params) {
                container.style.cursor = 'pointer';
            });
            
            network.on('blurNode', function(params) {
                container.style.cursor = 'default';
            });
        }
        
        // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —É–∑–ª–∞
        function highlightNode(nodeId) {
            selectedNodeId = nodeId;
            const node = allNodes.find(n => n.id === nodeId);
            if (!node) return;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–µ—Ä–º–∏–Ω–æ–≤
            const cards = document.querySelectorAll('.term-card');
            cards.forEach(card => {
                if (parseInt(card.dataset.id) === nodeId) {
                    card.classList.add('selected');
                    card.scrollIntoView({ behavior: 'smooth', block: 'center' });
                } else {
                    card.classList.remove('selected');
                }
            });
            
            // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –≤ –≥—Ä–∞—Ñ–µ
            const connectedNodes = network.getConnectedNodes(nodeId);
            const highlightNodes = [nodeId, ...connectedNodes];
            
            nodes.update(nodes.get().map(n => ({
                ...n,
                color: highlightNodes.includes(n.id) ? {
                    background: n.id === nodeId ? '#764ba2' : '#a8b5ff',
                    border: n.id === nodeId ? '#667eea' : '#667eea',
                    highlight: {
                        background: '#764ba2',
                        border: '#667eea'
                    }
                } : {
                    background: '#e0e0e0',
                    border: '#ccc',
                    highlight: {
                        background: '#667eea',
                        border: '#5568d3'
                    }
                }
            })));
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ —Ç–µ—Ä–º–∏–Ω–∞
        function showTermDetails(nodeId) {
            const node = allNodes.find(n => n.id === nodeId);
            if (!node) return;
            
            // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –¥–µ—Ç–∞–ª—è–º–∏
            console.log('–í—ã–±—Ä–∞–Ω —Ç–µ—Ä–º–∏–Ω:', node);
        }
        
        // –û—á–∏—Å—Ç–∏—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ
        function clearSelection() {
            selectedNodeId = null;
            document.querySelectorAll('.term-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            nodes.update(nodes.get().map(n => ({
                ...n,
                color: {
                    background: '#667eea',
                    border: '#5568d3',
                    highlight: {
                        background: '#764ba2',
                        border: '#667eea'
                    }
                }
            })));
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Ç–µ—Ä–º–∏–Ω–æ–≤ –≤ —Å–∞–π–¥–±–∞—Ä–µ (–¥–ª—è –≥—Ä–∞—Ñ–∞)
        async function loadTermsListSidebar() {
            try {
                const response = await fetch(`${API_BASE}/terms`);
                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ—Ä–º–∏–Ω–æ–≤');
                
                const terms = await response.json();
                const listContainer = document.getElementById('terms-list');
                
                listContainer.innerHTML = terms.map(term => `
                    <div class="term-card" data-id="${term.id}">
                        <div class="term-keyword" onclick="selectTerm(${term.id})">${term.keyword}</div>
                        <div class="term-description" onclick="selectTerm(${term.id})">${term.description.substring(0, 100)}${term.description.length > 100 ? '...' : ''}</div>
                        ${term.source ? `<div class="term-source" onclick="selectTerm(${term.id})">–ò—Å—Ç–æ—á–Ω–∏–∫: ${term.source}</div>` : ''}
                        <div class="term-actions">
                            <button class="btn-edit" onclick="editTerm(${term.id}, event)">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                            <button class="btn-delete" onclick="deleteTerm(${term.id}, event)">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ —Ç–µ—Ä–º–∏–Ω–æ–≤:', error);
            }
        }
        
        // –í—ã–±–æ—Ä —Ç–µ—Ä–º–∏–Ω–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
        function selectTerm(termId) {
            if (network) {
                network.focus(termId, {
                    scale: 1.5,
                    animation: {
                        duration: 1000,
                        easingFunction: 'easeInOutQuad'
                    }
                });
                highlightNode(termId);
            }
        }
        
        // –ü–æ–∏—Å–∫ —Ç–µ—Ä–º–∏–Ω–∞
        function searchTerm(event) {
            if (event.key === 'Enter') {
                const searchValue = document.getElementById('searchInput').value.toLowerCase().trim();
                if (!searchValue) {
                    clearSearch();
                    return;
                }
                
                const foundNode = allNodes.find(node => 
                    node.label.toLowerCase().includes(searchValue) ||
                    node.description.toLowerCase().includes(searchValue)
                );
                
                if (foundNode && network) {
                    selectTerm(foundNode.id);
                } else {
                    alert('–¢–µ—Ä–º–∏–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω');
                }
            }
        }
        
        // –û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫
        function clearSearch() {
            document.getElementById('searchInput').value = '';
            clearSelection();
            if (network) {
                network.fit({
                    animation: {
                        duration: 1000,
                        easingFunction: 'easeInOutQuad'
                    }
                });
            }
        }
        
        // –ü—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∞
        function zoomIn() {
            if (network) {
                const scale = network.getScale();
                const position = network.getViewPosition();
                network.moveTo({
                    position: position,
                    scale: Math.min(scale * 1.2, 4.0), // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –º–∞—Å—à—Ç–∞–± 4x
                    animation: {
                        duration: 300,
                        easingFunction: 'easeInOutQuad'
                    }
                });
            }
        }
        
        // –û—Ç–¥–∞–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∞
        function zoomOut() {
            if (network) {
                const scale = network.getScale();
                const position = network.getViewPosition();
                network.moveTo({
                    position: position,
                    scale: Math.max(scale * 0.8, 0.1), // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –º–∞—Å—à—Ç–∞–± 0.1x
                    animation: {
                        duration: 300,
                        easingFunction: 'easeInOutQuad'
                    }
                });
            }
        }
        
        // –°–±—Ä–æ—Å–∏—Ç—å –º–∞—Å—à—Ç–∞–± –≥—Ä–∞—Ñ–∞
        function resetZoom() {
            if (network) {
                network.fit({
                    animation: {
                        duration: 500,
                        easingFunction: 'easeInOutQuad'
                    }
                });
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –ª–µ–≥–µ–Ω–¥—É
        function toggleLegend() {
            const legend = document.getElementById('legend');
            if (!legend) return;
            
            const isVisible = legend.style.display === 'block';
            legend.style.display = isVisible ? 'none' : 'block';
            
            if (legend.style.display === 'block') {
                updateLegend();
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –≤–Ω–µ –ª–µ–≥–µ–Ω–¥—ã
                setTimeout(() => {
                    document.addEventListener('click', handleClickOutsideLegend);
                }, 10);
            } else {
                // –£–¥–∞–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–∏ —Å–∫—Ä—ã—Ç–∏–∏
                document.removeEventListener('click', handleClickOutsideLegend);
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –≤–Ω–µ –ª–µ–≥–µ–Ω–¥—ã
        function handleClickOutsideLegend(event) {
            const legend = document.getElementById('legend');
            const btnLegend = document.getElementById('btn-legend');
            
            if (!legend || !btnLegend) return;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª –ª–∏ –∫–ª–∏–∫ –≤–Ω–µ –ª–µ–≥–µ–Ω–¥—ã –∏ –∫–Ω–æ–ø–∫–∏
            if (!legend.contains(event.target) && !btnLegend.contains(event.target)) {
                legend.style.display = 'none';
                document.removeEventListener('click', handleClickOutsideLegend);
            }
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å –ª–µ–≥–µ–Ω–¥—É
        function updateLegend() {
            const legendContent = document.getElementById('legend-content');
            const relationTypes = new Set();
            
            allEdges.forEach(edge => {
                if (edge.type) {
                    relationTypes.add(edge.type);
                }
            });
            
            const sortedTypes = Array.from(relationTypes).sort();
            legendContent.innerHTML = sortedTypes.map(type => {
                const color = getRelationColor(type);
                return `
                    <div class="legend-item">
                        <span class="legend-color" style="background-color: ${color};"></span>
                        <span>${type}</span>
                    </div>
                `;
            }).join('');
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –≤–∏–¥–∞–º–∏
        function switchView(viewType) {
            const graphView = document.getElementById('graph-view');
            const listView = document.getElementById('list-view');
            const btnGraph = document.getElementById('btn-graph');
            const btnList = document.getElementById('btn-list');
            const graphControls = ['btn-refresh', 'searchInput', 'btn-clear', 'btn-legend'];
            
            if (!graphView || !listView || !btnGraph || !btnList) {
                console.error('–ù–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã DOM');
                return;
            }
            
            if (viewType === 'graph') {
                graphView.style.display = 'flex';
                listView.style.display = 'none';
                btnGraph.classList.add('active');
                btnList.classList.remove('active');
                graphControls.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.style.display = 'inline-block';
                });
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—Ç—å –≥—Ä–∞—Ñ
                const container = document.getElementById('graph-container');
                if (!container) {
                    console.error('–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –≥—Ä–∞—Ñ–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω');
                    return;
                }
                
                // –í—Å–µ–≥–¥–∞ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ–º –≥—Ä–∞—Ñ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ–±–ª–µ–º —Å —Ä–∞–∑–º–µ—Ä–∞–º–∏
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–¥–µ—Ä–∂–∫—É, —á—Ç–æ–±—ã DOM —É—Å–ø–µ–ª –æ–±–Ω–æ–≤–∏—Ç—å—Å—è –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è display
                setTimeout(() => {
                    // –£–Ω–∏—á—Ç–æ–∂–∞–µ–º —Å—Ç–∞—Ä—ã–π –≥—Ä–∞—Ñ, –µ—Å–ª–∏ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
                    if (network) {
                        network.destroy();
                        network = null;
                    }
                    
                    // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                    container.innerHTML = '<div class="loading" id="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –≥—Ä–∞—Ñ–∞...</div>';
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –≥—Ä–∞—Ñ –∑–∞–Ω–æ–≤–æ
                    loadGraph();
                }, 100);
            } else {
                graphView.style.display = 'none';
                listView.style.display = 'block';
                btnGraph.classList.remove('active');
                btnList.classList.add('active');
                graphControls.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.style.display = 'none';
                });
                loadTermsList();
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Ç–µ—Ä–º–∏–Ω–æ–≤ –≤ –≤–∏–¥–µ –∫–∞—Ä—Ç–æ—á–µ–∫ (–¥–ª—è –≤–∏–¥–∞ —Å–ø–∏—Å–∫–∞)
        async function loadTermsList() {
            try {
                const response = await fetch(`${API_BASE}/terms?limit=1000`);
                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ—Ä–º–∏–Ω–æ–≤');
                
                const terms = await response.json();
                const container = document.getElementById('terms-cards');
                
                // –°–æ—Ä—Ç–∏—Ä—É–µ–º —Ç–µ—Ä–º–∏–Ω—ã –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É
                terms.sort((a, b) => a.keyword.localeCompare(b.keyword));
                
                container.innerHTML = terms.map(term => `
                    <div class="term-card-full" data-id="${term.id}">
                        <div class="term-keyword">${term.keyword}</div>
                        <div class="term-description">${term.description || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}</div>
                        ${term.source ? `<div class="term-source">–ò—Å—Ç–æ—á–Ω–∏–∫: ${term.source}</div>` : ''}
                        <div class="term-actions">
                            <button class="btn-edit" onclick="editTerm(${term.id}, event)">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                            <button class="btn-delete" onclick="deleteTerm(${term.id}, event)">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ —Ç–µ—Ä–º–∏–Ω–æ–≤:', error);
                document.getElementById('terms-cards').innerHTML = 
                    `<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ${error.message}</div>`;
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–µ—Ä–º–∏–Ω–∞
        function showAddTermModal() {
            const modal = document.getElementById('termModal');
            const form = document.getElementById('termForm');
            const modalTitle = document.getElementById('modalTitle');
            const submitBtn = document.getElementById('submitBtn');
            const deleteBtn = document.getElementById('deleteBtn');
            
            modalTitle.textContent = '–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Ä–º–∏–Ω';
            submitBtn.textContent = '–î–æ–±–∞–≤–∏—Ç—å';
            deleteBtn.style.display = 'none';
            document.getElementById('termId').value = '';
            form.reset();
            modal.style.display = 'block';
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ—Ä–º–∏–Ω–∞
        async function editTerm(termId, event) {
            if (event) {
                event.stopPropagation();
            }
            
            try {
                const response = await fetch(`${API_BASE}/terms/${termId}`);
                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ—Ä–º–∏–Ω–∞');
                
                const term = await response.json();
                const modal = document.getElementById('termModal');
                const modalTitle = document.getElementById('modalTitle');
                const submitBtn = document.getElementById('submitBtn');
                const deleteBtn = document.getElementById('deleteBtn');
                
                modalTitle.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Ä–º–∏–Ω';
                submitBtn.textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å';
                deleteBtn.style.display = 'inline-block';
                
                document.getElementById('termId').value = term.id;
                document.getElementById('termKeyword').value = term.keyword;
                document.getElementById('termDescription').value = term.description;
                document.getElementById('termSource').value = term.source || '';
                
                modal.style.display = 'block';
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ—Ä–º–∏–Ω–∞: ' + error.message);
            }
        }
        
        // –£–¥–∞–ª–∏—Ç—å —Ç–µ—Ä–º–∏–Ω
        async function deleteTerm(termId, event) {
            if (event) {
                event.stopPropagation();
            }
            
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–µ—Ä–º–∏–Ω?')) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/terms/${termId}`, {
                    method: 'DELETE'
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç–µ—Ä–º–∏–Ω–∞');
                }
                
                alert('–¢–µ—Ä–º–∏–Ω —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ç–µ—Ä–º–∏–Ω–æ–≤
                if (document.getElementById('graph-view').style.display !== 'none') {
                    loadTermsListSidebar();
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –≥—Ä–∞—Ñ
                    if (network) {
                        network.destroy();
                        network = null;
                    }
                    loadGraph();
                } else {
                    loadTermsList();
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç–µ—Ä–º–∏–Ω–∞: ' + error.message);
            }
        }
        
        // –£–¥–∞–ª–∏—Ç—å —Ç–µ—Ä–º–∏–Ω –∏–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        function deleteTermFromModal() {
            const termId = document.getElementById('termId').value;
            if (termId) {
                closeTermModal();
                deleteTerm(parseInt(termId));
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        async function handleTermSubmit(event) {
            event.preventDefault();
            
            const termId = document.getElementById('termId').value;
            const keyword = document.getElementById('termKeyword').value.trim();
            const description = document.getElementById('termDescription').value.trim();
            const source = document.getElementById('termSource').value.trim();
            
            if (!keyword || !description) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
                return;
            }
            
            try {
                const termData = {
                    keyword: keyword,
                    description: description,
                    source: source || null
                };
                
                let response;
                if (termId) {
                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ç–µ—Ä–º–∏–Ω–∞
                    response = await fetch(`${API_BASE}/terms/${termId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(termData)
                    });
                } else {
                    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–µ—Ä–º–∏–Ω–∞
                    response = await fetch(`${API_BASE}/terms`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(termData)
                    });
                }
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ—Ä–º–∏–Ω–∞');
                }
                
                const savedTerm = await response.json();
                alert(termId ? '–¢–µ—Ä–º–∏–Ω —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω' : '–¢–µ—Ä–º–∏–Ω —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω');
                closeTermModal();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ç–µ—Ä–º–∏–Ω–æ–≤
                if (document.getElementById('graph-view').style.display !== 'none') {
                    loadTermsListSidebar();
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –≥—Ä–∞—Ñ
                    if (network) {
                        network.destroy();
                        network = null;
                    }
                    loadGraph();
                } else {
                    loadTermsList();
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ—Ä–º–∏–Ω–∞: ' + error.message);
            }
        }
        
        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        function closeTermModal() {
            const modal = document.getElementById('termModal');
            modal.style.display = 'none';
            document.getElementById('termForm').reset();
        }
        
        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        window.onclick = function(event) {
            const modal = document.getElementById('termModal');
            if (event.target === modal) {
                closeTermModal();
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', () => {
            // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ—Ç–∫—Ä—ã–≤–∞–µ–º –≥—Ä–∞—Ñ
            switchView('graph');
        });
    </script>
</body>
</html>

